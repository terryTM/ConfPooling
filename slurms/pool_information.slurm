#!/bin/bash
#SBATCH --job-name=pooling
#SBATCH --partition=gpu_p
#SBATCH --gres=gpu:A100:1
#SBATCH --ntasks=1
#SBATCH --mem=32G
#SBATCH --cpus-per-task=8
#SBATCH --time=19:00:00
#SBATCH --output=logs/%A_%a.log
#SBATCH --array=13

# ---- 1. åŠ è½½å¿…è¦æ¨¡å— ----
source ~/.bashrc
module load CUDA/12.8.0

# ---- 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ ----
source ~/PY_envs/deepconf_py312/bin/activate

# ---- 3. è¿›å…¥é¡¹ç›®ç›®å½• ----
cd ~/Projects/Method/deepconf

nvidia-smi

# ---- 4. è¿è¡Œç¨‹åºï¼Œä½¿ç”¨æ•°ç»„ç´¢å¼•å½“ä½œ qid ----
QID=${SLURM_ARRAY_TASK_ID}
DATASET_NAME="aime_2025"
OUT_DIR="data/processed/${DATASET_NAME}/pool_information_v22"
OUT_PATH="${OUT_DIR}/${DATASET_NAME}_${QID}_deepconflow_self_check.jsonl"

if [ -f "$OUT_PATH" ]; then
    echo "âœ… Skipping question ${QID}: result already exists at ${OUT_P ATH}"
    exit 0
fi

# è¿è¡Œä¸»è„šæœ¬
echo "ğŸš€ Running follow-up self-check for question ${QID}"
python examples/online_RL/approach_exploration/pool_information/pool_information.py \
    --question_id "$QID" \
    --output_dir "$OUT_DIR" \
    --data_name "$DATASET_NAME"

